unique(by = c("stationID")) %>%
ggplot(aes(ConvertLongitude(lon), lat)) +
geom_sf(data = map, inherit.aes = FALSE) +
geom_point(alpha = 0.5, aes(color = !is.na(as.numeric(stationID)))) +
scale_color_viridis_d()
obs[var == "t" & ens == "001" & date.time == date.time[1], .N, by = .(stationID, lon, lat)] %>%
unique(by = c("stationID")) %>%
ggplot(aes(ConvertLongitude(lon), lat)) +
geom_sf(data = map, inherit.aes = FALSE) +
geom_point(alpha = 0.5, aes(color = !is.na(as.numeric(stationID)))) +
scale_color_viridis_d() +
coord_sf(ylim = c(-42, -20), xlim = c(-75, -52)) +
labs(x = "Longitud", y = "Latitud") +
theme_minimal()
obs[var == "t" & ens == "001" & date.time == date.time[1], .N, by = .(stationID, lon, lat)] %>%
unique(by = c("stationID")) %>%
ggplot(aes(ConvertLongitude(lon), lat)) +
geom_sf(data = map, inherit.aes = FALSE) +
geom_point(alpha = 0.5, aes(color = !is.na(as.numeric(stationID)))) +
scale_color_distiller() +
coord_sf(ylim = c(-42, -20), xlim = c(-75, -52)) +
labs(x = "Longitud", y = "Latitud") +
theme_minimal()
obs[var == "t" & ens == "001" & date.time == date.time[1], .N, by = .(stationID, lon, lat)] %>%
unique(by = c("stationID")) %>%
ggplot(aes(ConvertLongitude(lon), lat)) +
geom_sf(data = map, inherit.aes = FALSE) +
geom_point(alpha = 0.5, aes(color = !is.na(as.numeric(stationID)))) +
scale_color_brewer() +
coord_sf(ylim = c(-42, -20), xlim = c(-75, -52)) +
labs(x = "Longitud", y = "Latitud") +
theme_minimal()
obs[var == "t" & ens == "001" & date.time == date.time[1], .N, by = .(stationID, lon, lat)] %>%
unique(by = c("stationID")) %>%
ggplot(aes(ConvertLongitude(lon), lat)) +
geom_sf(data = map, inherit.aes = FALSE) +
geom_point(alpha = 0.5, aes(color = !is.na(as.numeric(stationID)))) +
scale_color_manual() +
coord_sf(ylim = c(-42, -20), xlim = c(-75, -52)) +
labs(x = "Longitud", y = "Latitud") +
theme_minimal()
obs[var == "t" & ens == "001" & date.time == date.time[1], .N, by = .(stationID, lon, lat)] %>%
unique(by = c("stationID")) %>%
ggplot(aes(ConvertLongitude(lon), lat)) +
geom_sf(data = map, inherit.aes = FALSE) +
geom_point(alpha = 0.5, aes(color = !is.na(as.numeric(stationID)))) +
scale_color_manual(values = c("TRUE" = "orange", "FALSE" = "green")) +
coord_sf(ylim = c(-42, -20), xlim = c(-75, -52)) +
labs(x = "Longitud", y = "Latitud") +
theme_minimal()
obs[var == "t" & ens == "001" & date.time == date.time[1], .N, by = .(stationID, lon, lat)] %>%
unique(by = c("stationID")) %>%
ggplot(aes(ConvertLongitude(lon), lat)) +
geom_sf(data = map, inherit.aes = FALSE) +
geom_point(alpha = 0.5, aes(color = !is.na(as.numeric(stationID)))) +
scale_color_manual(name =  NULL, values = c("TRUE" = "orange", "FALSE" = "green")) +
coord_sf(ylim = c(-42, -20), xlim = c(-75, -52)) +
labs(x = "Longitud", y = "Latitud") +
theme_minimal()
obs[var == "t" & ens == "001" & date.time == date.time[1], .N, by = .(stationID, lon, lat)] %>%
unique(by = c("stationID")) %>%
ggplot(aes(ConvertLongitude(lon), lat)) +
geom_sf(data = map, inherit.aes = FALSE) +
geom_point(alpha = 0.5, aes(color = !is.na(as.numeric(stationID)))) +
scale_color_manual(name =  NULL, values = c("TRUE" = "#FD8002", "FALSE" = "#367DB7")) +
coord_sf(ylim = c(-42, -20), xlim = c(-75, -52)) +
labs(x = "Longitud", y = "Latitud") +
theme_minimal()
obs[var == "t" & ens == "001" & date.time == date.time[1], .N, by = .(stationID, lon, lat)] %>%
unique(by = c("stationID")) %>%
ggplot(aes(ConvertLongitude(lon), lat)) +
geom_sf(data = map, inherit.aes = FALSE) +
geom_point(aes(color = !is.na(as.numeric(stationID)))) +
scale_color_manual(name =  NULL, values = c("TRUE" = "#FD8002", "FALSE" = "#367DB7")) +
coord_sf(ylim = c(-42, -20), xlim = c(-75, -52)) +
labs(x = "Longitud", y = "Latitud") +
theme_minimal()
obs[var == "t" & ens == "001" & date.time == date.time[1], .N, by = .(stationID, lon, lat)] %>%
unique(by = c("stationID")) %>%
ggplot(aes(ConvertLongitude(lon), lat)) +
geom_sf(data = map, inherit.aes = FALSE) +
geom_point(aes(color = is.na(as.numeric(stationID)))) +
scale_color_manual(name =  NULL, values = c("TRUE" = "#FD8002", "FALSE" = "#367DB7")) +
coord_sf(ylim = c(-42, -20), xlim = c(-75, -52)) +
labs(x = "Longitud", y = "Latitud") +
theme_minimal()
obs[var == "t" & ens == "001" & date.time == date.time[1], .N, by = .(stationID, lon, lat)] %>%
unique(by = c("stationID"))
library(tidyverse)
str_detect(obs$stationID, "SMN")
obs[str_detect(obs$stationID, "SMN")]
obs[str_detect(stationID, "SMN")]
unique(obs, by = c("stationID")) %>%
.[str_detect(stationID, "SMN")] %>%
ggplot(aes(ConvertLongitude(lon), lat)) +
geom_sf(data = map, inherit.aes = FALSE) +
geom_point(aes(color = is.na(as.numeric(stationID)))) +
scale_color_manual(name =  NULL, values = c("TRUE" = "#FD8002", "FALSE" = "#367DB7")) +
coord_sf(ylim = c(-42, -20), xlim = c(-75, -52)) +
labs(x = "Longitud", y = "Latitud") +
theme_minimal()
unique(obs, by = c("stationID")) %>%
.[!str_detect(stationID, "SMN")] %>%
ggplot(aes(ConvertLongitude(lon), lat)) +
geom_sf(data = map, inherit.aes = FALSE) +
geom_point(aes(color = is.na(as.numeric(stationID)))) +
scale_color_manual(name =  NULL, values = c("TRUE" = "#FD8002", "FALSE" = "#367DB7")) +
coord_sf(ylim = c(-42, -20), xlim = c(-75, -52)) +
labs(x = "Longitud", y = "Latitud") +
theme_minimal()
unique(obs, by = c("stationID")) %>%
.[!str_detect(stationID, "SMN")] %>%
ggplot(aes(ConvertLongitude(lon), lat)) +
geom_sf(data = map, inherit.aes = FALSE) +
geom_point(aes(color = is.na(as.numeric(stationID)))) +
scale_color_manual(name =  NULL, values = c("TRUE" = "#FD8002", "FALSE" = "#367DB7"),
breaks = c("FALSE", "TRUE"),
labels = c("Official", "Non-official"))+
coord_sf(ylim = c(-42, -20), xlim = c(-75, -52)) +
labs(x = "Longitud", y = "Latitud") +
theme_minimal()
unique(obs, by = c("stationID")) %>%
.[!str_detect(stationID, "SMN")] %>%
ggplot(aes(ConvertLongitude(lon), lat)) +
geom_sf(data = map, inherit.aes = FALSE) +
geom_point(aes(alpha = 0.7, color = is.na(as.numeric(stationID)))) +
scale_color_manual(name =  NULL, values = c("TRUE" = "#FD8002", "FALSE" = "#367DB7"),
breaks = c("FALSE", "TRUE"),
labels = c("Official", "Non-official"))+
coord_sf(ylim = c(-42, -20), xlim = c(-75, -52)) +
labs(x = "Longitud", y = "Latitud") +
theme_minimal()
unique(obs, by = c("stationID")) %>%
.[!str_detect(stationID, "SMN")] %>%
ggplot(aes(ConvertLongitude(lon), lat)) +
geom_sf(data = map, inherit.aes = FALSE) +
geom_point(aes(alpha = 0.8, color = is.na(as.numeric(stationID)))) +
scale_color_manual(name =  NULL, values = c("TRUE" = "#FD8002", "FALSE" = "#367DB7"),
breaks = c("FALSE", "TRUE"),
labels = c("Official", "Non-official"))+
coord_sf(ylim = c(-42, -20), xlim = c(-75, -52)) +
labs(x = "Longitud", y = "Latitud") +
theme_minimal()
unique(obs, by = c("stationID")) %>%
.[!str_detect(stationID, "SMN")] %>%
ggplot(aes(ConvertLongitude(lon), lat)) +
geom_sf(data = map, inherit.aes = FALSE) +
geom_point(alpha = 0.9, aes(color = is.na(as.numeric(stationID)))) +
scale_color_manual(name =  NULL, values = c("TRUE" = "#FD8002", "FALSE" = "#367DB7"),
breaks = c("FALSE", "TRUE"),
labels = c("Official", "Non-official"))+
coord_sf(ylim = c(-42, -20), xlim = c(-75, -52)) +
labs(x = "Longitud", y = "Latitud") +
theme_minimal()
unique(obs, by = c("stationID")) %>%
.[!str_detect(stationID, "SMN")] %>%
ggplot(aes(ConvertLongitude(lon), lat)) +
geom_sf(data = map, inherit.aes = FALSE) +
geom_point(alpha = 0.8, aes(color = is.na(as.numeric(stationID)))) +
scale_color_manual(name =  NULL, values = c("TRUE" = "#FD8002", "FALSE" = "#367DB7"),
breaks = c("FALSE", "TRUE"),
labels = c("Official", "Non-official"))+
coord_sf(ylim = c(-42, -20), xlim = c(-75, -52)) +
labs(x = "Longitud", y = "Latitud") +
theme_minimal()
unique(obs, by = c("stationID")) %>%
.[!str_detect(stationID, "SMN")] %>%
ggplot(aes(ConvertLongitude(lon), lat)) +
geom_sf(data = map, inherit.aes = FALSE) +
geom_point(alpha = 0.8, aes(color = is.na(as.numeric(stationID)))) +
scale_color_manual(name =  NULL, values = c("TRUE" = "#FD8002", "FALSE" = "#367DB7"),
breaks = c("FALSE", "TRUE"),
labels = c("Official", "Non-official"))+
coord_sf(ylim = c(-42, -20), xlim = c(-75, -52)) +
labs(x = "Longitud", y = "Latitud") +
theme_minimal() +
theme(legend.position = "bottom")
obs[ens == 1 & date.time == date.time[1], .N, by = .(stationID)]
obs[ens == 1 & date.time == date.time[1], .N]
obs[ens == 1 & date.time == date.time[1]]
obs[ens == 1 & date.time == unique(date.time)[1]]
obs[ens == "001" & date.time == unique(date.time)[1]]
obs[ens == "001" & date.time == unique(date.time)[1], .N]
obs[ens == "001" & date.time == unique(date.time)[1]] %>%
.[, station := ifelse(is.na(as.numeric(stationID)), "non-official", "offitial")]
obs[ens == "001" & date.time == unique(date.time)[1]] %>%
.[, station := ifelse(is.na(as.numeric(stationID)), "non-official", "offitial")] %>%
.[, .N, by = .(station)]
obs[ens == "001" & date.time == unique(date.time)[1]] %>%
unique(by = c("stationID")) %>%
.[, station := ifelse(is.na(as.numeric(stationID)), "non-official", "offitial")] %>%
.[, .N, by = .(station)]
obs[ens == "001" & date.time == unique(date.time)[1]] %>%
# unique(by = c("stationID")) %>%
.[, station := ifelse(is.na(as.numeric(stationID)), "non-official", "offitial")] %>%
.[, .N, by = .(station)]
4996+463
unique(obs, by = c("stationID")) %>%
.[!str_detect(stationID, "SMN")] %>%
ggplot(aes(ConvertLongitude(lon), lat)) +
geom_sf(data = map, inherit.aes = FALSE) +
geom_point(alpha = 0.8, aes(color = is.na(as.numeric(stationID)))) +
scale_color_manual(name =  NULL, values = c("TRUE" = "#FD8002", "FALSE" = "#367DB7"),
breaks = c("FALSE", "TRUE"),
labels = c("Official (116)", "Non-official (409)"))+
coord_sf(ylim = c(-42, -20), xlim = c(-75, -52)) +
labs(x = "Longitud", y = "Latitud") +
theme_minimal() +
theme(legend.position = "bottom")
unique(obs, by = c("stationID")) %>%
.[!str_detect(stationID, "SMN")] %>%
ggplot(aes(ConvertLongitude(lon), lat)) +
geom_sf(data = map, inherit.aes = FALSE) +
geom_point(alpha = 0.8, aes(color = is.na(as.numeric(stationID)))) +
scale_color_manual(name =  NULL, values = c("TRUE" = "#FD8002", "FALSE" = "#367DB7"),
breaks = c("FALSE", "TRUE"),
labels = c("Official (N = 116)", "Non-official (N = 409)"))+
coord_sf(ylim = c(-42, -20), xlim = c(-75, -52)) +
labs(x = "Longitud", y = "Latitud") +
theme_minimal() +
theme(legend.position = "bottom")
unique(obs, by = c("stationID")) %>%
.[!str_detect(stationID, "SMN")] %>%
ggplot(aes(ConvertLongitude(lon), lat)) +
geom_sf(data = map, inherit.aes = FALSE) +
geom_point(alpha = 0.8, aes(color = is.na(as.numeric(stationID)))) +
scale_color_manual(name =  NULL, values = c("TRUE" = "#FD8002", "FALSE" = "#367DB7"),
breaks = c("FALSE", "TRUE"),
labels = c("Official (N = 116)", "Non-official (N = 409)"))+
coord_sf(ylim = c(-42, -20), xlim = c(-75, -52)) +
labs(x = "Longitud", y = "Latitud") +
theme_minimal(base_size = 18) +
theme(legend.position = "bottom")
remotes::install_github("eliocamp/mountr")
exp(4.5549-log(95.3908))
1-exp(4.5549-log(95.3908))
1-exp(4.5549-log(95.3908))*10
log(95.3908)
45549-4557982
4.5549-4.557982
exp(4.5549-4.557982)
1-exp(4.5549-4.557982)
*10
(1-exp(4.5549-4.557982))*10
1/(0.0085357e-2 * 0.2)
0.2*0.000085357
1/(0.2*0.000085357)
1/6.934478e-3
knitr::opts_chunk$set(echo = TRUE)
library(data.table)
library(dplyr)
library(metR)
library(patchwork)
library(ggplot2)
# Recorto el dominio y las variables para trabajar mejor
files <- Sys.glob("E1/test/*.nc")
model <- lapply(files, function(f) {
ReadNetCDF(f, vars = c("T", "MU"),
subset = list(bottom_top = 1:5)) %>%
.[, model := gsub(".nc", "", basename(f))]
}) %>%
rbindlist()
model[bottom_top == 1] %>%
dcast(bottom_top + south_north + west_east ~ model, value.var = "MU") %>%
ggplot(aes(west_east, south_north)) +
geom_contour(aes(z = (ana187 - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla temperatura potencial \n(theta-t0 en K)")
# model <- lapply(files, function(f) {
#   ReadNetCDF(f, vars = c("U"),
#                   subset = list(bottom_top = 1:5)) %>%
#     .[, model := gsub(".nc", "", basename(f))]
#   }) %>%
#   rbindlist()
#
# dcast(model, bottom_top + south_north + west_east_stag ~ model, value.var = "U") %>%
#   .[bottom_top == 1] %>%
#   ggplot(aes(west_east_stag, south_north)) +
#   geom_contour(aes(z = (ana187 - guess))) +
#   scale_fill_viridis_c() +
#   coord_fixed() +
#   labs(title = "ana-guess en el viento zonal")
str(model)
unique(model$model)
model[bottom_top == 1] %>%
dcast(bottom_top + south_north + west_east ~ model, value.var = "MU") %>%
ggplot(aes(west_east, south_north)) +
geom_contour(aes(z = (ana187_ok - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla temperatura potencial \n(theta-t0 en K)")
model[bottom_top == 1] %>%
dcast(bottom_top + south_north + west_east ~ model, value.var = "MU") %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana187_ok - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla temperatura potencial \n(theta-t0 en K)")
files <- Sys.glob("E1/test/*.nc")
model <- lapply(files, function(f) {
ReadNetCDF(f, vars = c("T", "MU"),
subset = list(bottom_top = 1:5)) %>%
.[, model := gsub(".nc", "", basename(f))]
}) %>%
rbindlist()
model[bottom_top == 1] %>%
dcast(bottom_top + south_north + west_east ~ model, value.var = "MU") %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana187_ok - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla temperatura potencial \n(theta-t0 en K)")
model[bottom_top == 1] %>%
dcast(bottom_top + south_north + west_east ~ model, value.var = "T") %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana187_t - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla temperatura potencial \n(theta-t0 en K)")
# Recorto el dominio y las variables para trabajar mejor
files <- Sys.glob("E1/test/*.nc")
model <- lapply(files, function(f) {
ReadNetCDF(f, vars = c("T", "QVAPOR"),
subset = list(bottom_top = 1:5)) %>%
.[, model := gsub(".nc", "", basename(f))]
}) %>%
rbindlist()
model[bottom_top == 1] %>%
dcast(bottom_top + south_north + west_east ~ model, value.var = "T") %>%
ggplot(aes(west_east, south_north)) +
geom_contour(aes(z = (ana187 - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla temperatura potencial \n(theta-t0 en K)")
# model <- lapply(files, function(f) {
#   ReadNetCDF(f, vars = c("U"),
#                   subset = list(bottom_top = 1:5)) %>%
#     .[, model := gsub(".nc", "", basename(f))]
#   }) %>%
#   rbindlist()
#
# dcast(model, bottom_top + south_north + west_east_stag ~ model, value.var = "U") %>%
#   .[bottom_top == 1] %>%
#   ggplot(aes(west_east_stag, south_north)) +
#   geom_contour(aes(z = (ana187 - guess))) +
#   scale_fill_viridis_c() +
#   coord_fixed() +
#   labs(title = "ana-guess en el viento zonal")
model[bottom_top == 1] %>%
dcast(bottom_top + south_north + west_east ~ model, value.var = "T") %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana187_t - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla temperatura potencial \n(theta-t0 en K)")
model[bottom_top == 1] %>%
dcast(bottom_top + south_north + west_east ~ model, value.var = "QVAPOR") %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana187_q - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la humedad kg/kg")
knitr::opts_chunk$set(echo = TRUE)
library(data.table)
library(dplyr)
library(metR)
library(patchwork)
library(ggplot2)
diag <- fread("E1/test/test.csv") %>%
.[, c("V2", "V4") := NULL]
colnames(diag) <- c("var", "stationID", "type", "dhr", "lat", "lon", "pressure", "usage.flag", "obs", "obs.guess", "obs2", "obs.guess2", "rerr")
knitr::kable(diag)
# Recorto el dominio y las variables para trabajar mejor
files <- Sys.glob("E1/test/*.nc")
model <- lapply(files, function(f) {
ReadNetCDF(f, vars = c("T", "MU"),
subset = list(bottom_top = 1:5)) %>%
.[, model := gsub(".nc", "", basename(f))]
}) %>%
rbindlist()
dcast(model, bottom_top + south_north + west_east ~ model, value.var = "T") %>%
.[bottom_top == 1] %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla temperatura potencial \n(theta-t0 en K)") +
dcast(model, bottom_top + south_north + west_east ~ model, value.var = "MU") %>%
.[bottom_top == 1] %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla de la masa de aire seco (Pa)")
model <- lapply(files, function(f) {
ReadNetCDF(f, vars = c("U"),
subset = list(bottom_top = 1:5)) %>%
.[, model := gsub(".nc", "", basename(f))]
}) %>%
rbindlist()
dcast(model, bottom_top + south_north + west_east_stag ~ model, value.var = "U") %>%
.[bottom_top == 1] %>%
ggplot(aes(west_east_stag, south_north)) +
geom_contour_fill(aes(z = (ana - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en el viento zonal")
# Recorto el dominio y las variables para trabajar mejor
files <- Sys.glob("E1/test/*.nc")
model <- lapply(files, function(f) {
ReadNetCDF(f, vars = c("T", "QVAPOR"),
subset = list(bottom_top = 1:5)) %>%
.[, model := gsub(".nc", "", basename(f))]
}) %>%
rbindlist()
model[bottom_top == 1] %>%
dcast(bottom_top + south_north + west_east ~ model, value.var = "T") %>%
ggplot(aes(west_east, south_north)) +
geom_contour(aes(z = (ana187 - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla temperatura potencial \n(theta-t0 en K)")
# model <- lapply(files, function(f) {
#   ReadNetCDF(f, vars = c("U"),
#                   subset = list(bottom_top = 1:5)) %>%
#     .[, model := gsub(".nc", "", basename(f))]
#   }) %>%
#   rbindlist()
#
# dcast(model, bottom_top + south_north + west_east_stag ~ model, value.var = "U") %>%
#   .[bottom_top == 1] %>%
#   ggplot(aes(west_east_stag, south_north)) +
#   geom_contour(aes(z = (ana187 - guess))) +
#   scale_fill_viridis_c() +
#   coord_fixed() +
#   labs(title = "ana-guess en el viento zonal")
model[bottom_top == 1] %>%
dcast(bottom_top + south_north + west_east ~ model, value.var = "T") %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana187_t - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla temperatura potencial \n(theta-t0 en K)")
model[bottom_top == 1] %>%
dcast(bottom_top + south_north + west_east ~ model, value.var = "QVAPOR") %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana187_q - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la humedad kg/kg")
model[bottom_top == 1]
model[bottom_top == 1] %>%
dcast(bottom_top + south_north + west_east ~ model, value.var = "T") %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana187_t - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla temperatura potencial \n(theta-t0 en K)")
knitr::opts_chunk$set(echo = TRUE)
library(data.table)
library(dplyr)
library(metR)
library(patchwork)
library(ggplot2)
diag <- fread("E1/test/test.csv") %>%
.[, c("V2", "V4") := NULL]
colnames(diag) <- c("var", "stationID", "type", "dhr", "lat", "lon", "pressure", "usage.flag", "obs", "obs.guess", "obs2", "obs.guess2", "rerr")
knitr::kable(diag)
# Recorto el dominio y las variables para trabajar mejor
files <- Sys.glob("E1/test/*.nc")
model <- lapply(files, function(f) {
ReadNetCDF(f, vars = c("T", "MU"),
subset = list(bottom_top = 1:5)) %>%
.[, model := gsub(".nc", "", basename(f))]
}) %>%
rbindlist()
dcast(model, bottom_top + south_north + west_east ~ model, value.var = "T") %>%
.[bottom_top == 1] %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla temperatura potencial \n(theta-t0 en K)") +
dcast(model, bottom_top + south_north + west_east ~ model, value.var = "MU") %>%
.[bottom_top == 1] %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla de la masa de aire seco (Pa)")
model <- lapply(files, function(f) {
ReadNetCDF(f, vars = c("U"),
subset = list(bottom_top = 1:5)) %>%
.[, model := gsub(".nc", "", basename(f))]
}) %>%
rbindlist()
dcast(model, bottom_top + south_north + west_east_stag ~ model, value.var = "U") %>%
.[bottom_top == 1] %>%
ggplot(aes(west_east_stag, south_north)) +
geom_contour_fill(aes(z = (ana - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en el viento zonal")
model[bottom_top == 1] %>%
dcast(bottom_top + south_north + west_east ~ model, value.var = "T") %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana187_t - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla temperatura potencial \n(theta-t0 en K)")
model[bottom_top == 1]
