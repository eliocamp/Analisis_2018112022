---
title: "103_sondeos_RELAMPAGO"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(metR)
library(data.table)
library(tidyverse)
library(lubridate)
```

```{r}
path <- "/home/paola.corrales/datosmunin/DA/DA_DATA/OBS_RELAMPAGO/sondeos_nc/"

files <- list.files(path, pattern = ".nc", full.names = TRUE)

sondeos <- purrr::map(files, function(x) {
  # cat(x)
  vars <- setdiff(names(GlanceNetCDF(x)$vars), c("llat", "llon", "lalt"))
  ReadNetCDF(x, vars = vars) %>% 
    .[, launch_time := with_tz(force_tz(launch_time, tzone = "America/Argentina/Buenos_Aires"),
                               tzone = "UTC")] %>% 
    .[, Time := seconds(Time) + launch_time] %>% 
    .[!is.nan(Time) & launch_time %between% c(as_datetime("2018-11-20 18:00:00", tz = "UTC"), as_datetime("2018-11-23 15:00:00", tz = "UTC"))] %>% 
    .[, ":="(Site = str_split(basename(x), "_")[[1]][1])] %>% 
    .[, lapply(.SD, function(x) replace(x, x == 999 | is.nan(x), NA))]
}) %>% 
  rbindlist()

```

Hay 129 sondeos entre las 18Z del 20/11 y las 12Z del 23/11!

```{r}
sondeos %>% 
  unique(by = c("launch_time", "Site")) %>% 
  .[, .N, by = Site] %>% 
  knitr::kable()
```

## Intento de interpolaci√≥n

```{r}
library(reticulate)

wrf <- import("wrf")
ncdf <- import("netCDF4")

file_in <- "/home/paola.corrales/datosmunin/EXP/E4/ANA/20181120180000/analysis.mem001"

ncfile <-  ncdf$Dataset(file_in)
p <- wrf$getvar(ncfile, varname = "pressure", meta = FALSE)
uv <- wrf$getvar(ncfile, varname = "uvmet")

p_r <- py_to_r(p)

class(p)

```


